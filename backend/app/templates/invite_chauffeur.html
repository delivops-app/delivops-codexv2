<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Inviter un chauffeur</title>
</head>
<body>
    <h1>Inviter un chauffeur</h1>
    <p>Quota actuel: <span id="quota"></span></p>
    <form id="inviteForm" action="/chauffeurs/" method="post">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>

        <label for="display_name">Nom affiché:</label>
        <input type="text" id="display_name" name="display_name" required>

        <button type="submit">Inviter</button>
    </form>
    <p id="message"></p>

    <script>
    const tenantId = "{{ tenant_id }}";

    async function loadQuota() {
        try {
            const res = await fetch('/chauffeurs/count', {
                headers: { 'X-Tenant-Id': tenantId }
            });
            if (res.ok) {
                const data = await res.json();
                document.getElementById('quota').textContent = `${data.count}/${data.subscribed}`;
            } else {
                document.getElementById('quota').textContent = 'Erreur';
            }
        } catch (err) {
            document.getElementById('quota').textContent = 'Erreur';
        }
    }

    document.getElementById('inviteForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const body = {
            email: form.email.value,
            display_name: form.display_name.value
        };
        try {
            const res = await fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Tenant-Id': tenantId
                },
                body: JSON.stringify(body)
            });
            if (res.ok) {
                document.getElementById('message').textContent = 'Invitation envoyée';
                form.reset();
            } else {
                const data = await res.json();
                document.getElementById('message').textContent = data.detail || "Erreur lors de l'invitation";
            }
        } catch (err) {
            document.getElementById('message').textContent = "Erreur lors de l'invitation";
        }
        loadQuota();
    });

    loadQuota();
    </script>
</body>
</html>
